#!/usr/bin/env ruby



def getPercentage
  begin
    now = File.read("/sys/class/power_supply/BAT0/energy_now").to_f
    full = File.read("/sys/class/power_supply/BAT0/energy_full").to_f
    percentage = "%05.2f" % ((now/full) * 100)
    return "#{percentage}%"
  rescue
    return ""
  end
end

def getStatus
  begin
    return File.read("/sys/class/power_supply/BAT0/status").chomp!
  rescue
    return ""
  end
end

hostname = %x[hostname].chomp!

if (hostname == "chip") then
  dead = 3280
  full = 4200
  now = %x[cat /usr/lib/pocketchip-batt/voltage].to_f
  percentage = 100 * (now - dead).to_f / (full - dead).to_f.round(2)
  puts "#{percentage}%"
  exit
end


if (ARGV[0] == "percentage") then
  puts getPercentage
elsif (ARGV[0] == "status") then
  puts getStatus
else
  puts "#{getStatus} #{getPercentage}"
end


